# SpriteAnimManager <精灵动画管理器>

完成精灵动画功能的三个插件之一  
+ 插件[`TextSprite`](./../TextSprite)(本插件)
  - 用于支持绘制和控制播放动画等
+ 插件[`SpriteAnimationSet`](./../SpriteAnimationSet)
  - 用于提供处理动画效果等
+ 插件[`SpriteAnimManager`](./../SpriteAnimManager)
  - 用于设置动画和动画参数、处理消息框文字播放动画等

首先对动画进行配置，
每个动画id可以指定一个基础动画，并且可以配置一组参数，操作详见 【插件指令】  
之后在编辑消息使用控制字符触发一些播放或控制动画的操作，详见 插件【控制字符】  

#### 动画id
动画分为基础动画和自定义参数动画  
+ 基础动画拥有固定的默认参数，id分布在0~100
+ 自定义参数动画可以指定一个基础动画，并使用自己设置的参数，id分布在101及以后

#### 动画参数
可以在插件参数中配置初始动画参数  
+ 每条配置：有一个动画id，一个基础动画id，和一组参数
+ 每条参数：有一个参数序号或一个参数名，和一个参数值
也可以通过插件指令，在游戏中修改动画参数，详见 【插件指令】  

在游戏中进行的修改并不会保存，
这里的建议是，在插件参数中配置需要大量使用的固定的参数组，需要使用时直接使用对应id即可  


## 使用方法

按顺序导入 完成精灵动画功能的三个插件  
+ [`TextSprite`](./../TextSprite)
+ [`SpriteAnimationSet`](./../SpriteAnimationSet)
+ [`SpriteAnimManager`](./../SpriteAnimManager)

使用插件参数或插件指令对动画进行设置  
在【显示文本】之前，需要设置动画，详见 【插件指令】  
之后在【显示文本】里编辑消息时，使用控制字符触发操作，详见 【控制字符】  

可参考 【使用示例】  


## 插件指令

| description            | command                 |
| :--------------------- | :---------------------- |
| 设置或清除用户动画     | `AnimMgr setAnim 用户动画id 默认动画id` |
| 设置动画参数(按序号)   | `AnimMgr setParam 动画id 参数序号 参数值` |
| 设置动画参数(按参数名) | `AnimMgr setParamByKey 动画id 参数名 参数值` |
| 设置动画参数(所有参数) | `AnimMgr setParams 动画id 参数值1 参数值2 参数值3 ..` |
| 清除动画的全部参数     | `AnimMgr clearparams 动画id` |

#### 设置或清除用户动画
设置一个用户动画，这个动画使用默认动画的模板，并且可以配置参数  
不会自动清除动画参数  

* `AnimMgr setAnim 用户动画id 默认动画id`
+ AnimMgr
  - 主命令
  - 固定写法，不区分大小写
+ setAnim
  - 子命令
  - 固定写法，不区分大小写
+ 用户动画id
  - 所设置的用户动画的id
  - 数值，用户动画id，大于等于101
+ 默认动画id
  - 作为模板的默认动画的id
  - 数值，默认动画id，小于等于100，大于等于0
  - 当设置为0时，表示清除用户动画

#### 设置动画参数(按序号)
设置用户动画的一个参数的值  
用 【其他说明】-【动画列表】 中的 [参数序号] 指定参数  

* `AnimMgr setParam 动画id 参数序号 参数值`
+ AnimMgr
+ setParam
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 需要设置参数的用户动画的id
  - 同 【设置或清除用户动画】-【用户动画id】
+ 参数序号
  - 需要设置的参数的序号
  - 数值，详见 【其他说明】-【动画列表】 的 [参数序号]
+ 参数值
  - 需要设置的参数值
  - 数值或字串，详见 【其他说明】-【动画列表】 的 [参数类型]

#### 设置动画参数(按参数名)
设置用户动画的一个参数的值  
用 【其他说明】-【动画列表】 中的 [参数名] 指定参数  

* `AnimMgr setParamByKey 动画id 参数名 参数值`
+ AnimMgr
+ setParamByKey
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】
+ 参数名
  - 需要设置的参数的参数名
  - 字符串，详见 【其他说明】-【动画列表】 的 [参数名]
+ 参数值
  - 同 【设置动画参数(按序号)】-【参数值】

#### 设置动画参数(所有参数)
设置用户动画的所有参数的值  
按 【其他说明】-【动画列表】 中参数的顺序，设置每个参数的值  

* `AnimMgr setParams 动画id 参数值1 参数值2 参数值3 ..`
+ AnimMgr
+ setParams
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】
+ `参数值1 参数值2 参数值3 ..`
  - 需要设置的所有参数的参数值
  - 按 【其他说明】-【动画列表】 中的参数顺序 排列
  - 每个参数值用一个空格分隔
  - 数值或字串，详见 【其他说明】-【动画列表】 的 [参数名]

#### 清除动画的全部参数
清除用户动画的所有参数的值，恢复到默认参数值  

* `AnimMgr clearparams 动画id`
+ AnimMgr
+ clearparams
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】


## 插件指令 (MZ)

| description            |
| :--------------------- |
| 设置用户动画           |
| 清除用户动画           |
| 设置动画参数(按序号)   |
| 设置动画参数(按参数名) |
| 设置动画参数(所有参数) |
| 清除动画的全部参数     |


## 控制字符

在编辑消息文本时，可以使用类似 `\ABC` 或 `\ABC[123]` 的控制字符。  
控制字符 可以用来 执行操作 或 显示特殊内容。  
显示文本时，文字将会顺序显示，当到达控制字符时，将会执行对应操作或显示对应内容。  
控制字符不区分大小写，参数只能使用数字  

| description | symbol          | param |
| :---------- | :-------------- | :---- |
| 创建动画     | `\TEXTANIM[..]` | 动画id |
| 播放动画     | `\TAPLAY[..]`   | 动画id |
| 停止动画(未完成)     | `\TASTOP[..]`   | 动画id |
| 暂停动画(未完成)     | `\TAPAUSE[..]`  | 动画id |
| 继续动画(未完成)     | `\TACONT[..]`   | 动画id |
| 开始添加文本(未完成) | `\TAADDON[..]`  | 动画id |
| 停止添加文本(未完成) | `\TAADDOFF[..]` | 动画id |

#### 创建动画
为文本创建一个动画  
显示文字进行到该控制字符时，将会创建动画  
创建动画后，动画会开始准备，但不会直接播放  
TEXTANIM : text animation  

* `\TEXTANIM[..]`
+ 参数
  - 动画id

#### 播放动画
播放指定动画(创建动画后不会自动播放)  
TAPLAY : text animtion play  

* `\TAPLAY[..]`
+ 参数
  - 动画id

#### 停止动画
停止指定动画  
TAPAUSE : text animtion stop  

* `\TASTOP[..]`
+ 参数
  - 动画id

#### 暂停动画
暂停指定动画  
TACONT : text animtion pause  

* `\TAPAUSE[..]`
+ 参数
  - 动画id

#### 继续动画
继续指定动画  
TASTOP : text animtion continue  

* `\TACONT[..]`
+ 参数
  - 动画id

#### 开始添加文本
关闭指定动画添加文本  
TAADDOFF : text animtion add on  

* `\TAADDON[..]`
+ 参数
  - 动画id

#### 停止添加文本
开启指定动画添加文本(默认开启)  
TAADDOFF : text animtion add off  

* `\TAADDOFF[..]`
+ 参数
  - 动画id


## 使用示例

#### 让一段文字同时淡入显示
配置动画id=101为基础动画id=1  
在【显示文本】中编辑 : `\TextAnim[101]\>我是一段文字\TAplay[101]`  

说明 :  
首先创建动画，使得之后的文字能被动画识别 : `\TextAnim[101]`  
文字需要同时显示，所以需要开启快速显示模式 : `\>`  
之后输入需要的文字  
最后开启动画，使得文字同时进行动画 : `\TAplay[101]`  

#### 播放【缩放】效果
+ 事件
  - ◆插件指令：AnimMgr setAnim 101 3
  - ◆文本：无, 窗口, 底部
  - ：　　：以下文字播放缩放效果：\TEXTANIM[101]\TAPlay[101]只有这句话会受效果影响


## 脚本说明

TODO


## 其他说明

#### 动画列表
详细说明和参数见插件【SpriteAnimationSet】  
注 : id 为 默认动画id  
| id | 动画效果 |
| :- | :------- |
|  2 | 淡入淡出 |
|  3 | 缩放     |
|  4 | 翻转     |
|  5 | 上下出现(未完成) |
|  6 | 震动     |
|  7 | 剧烈缩放 |
|  8 | 波浪缩放 |
|  9 | 旋涡     |
| 10 | 摇晃     |
| 11 | 随机     |
| 32 | 卡拉Ok   |
| 52 | 文字居中 |

#### 对于简化设置决定的说明

简化设置方面，有两种方案：  
一是保存在游戏存档中  
可以保存，所以在游戏开始时进行统一设置即可，这样可能会因为使用过期存档而失效  
二是使用插件参数进行设置  
这样每次启动会重置设置，所以不能保存，但是不会因为使用过期存档而失效  
二者不能兼得。  

这里使用方案二，原因如下：  
考虑到 固定设置的情况 比 根据游戏情况需要调整设置的情况 多；  
因为变数多，而使得保险起见会在使用前再次进行设置，所以使用到保存数据的设置的情况较少；  
多次使用固定设置时，为了方便调整设置，不建议在每次使用前都进行设置，  
作为代替的是，使用固定的一组设置，并把这组设置放在插件参数中。  


## 后续任务

- [ ] 更准确地功能划分 : SpriteAnimManager 用来管理和播放动画，TextSprite 只用于支持绘制和动画等功能
- [x] 更新插件说明
- [ ] 调整基础动画和用户动画的code，使得不会冲突
- [ ] 优化管理文本动画对象，不反复创建和清除对象，而是清空动画目标并禁用文本动画对象(文本动画类提供该方法)


## Author
Mikan(MikanHako)  
Copyright (C) 2019-2024 Mikan(MikanHako)  
