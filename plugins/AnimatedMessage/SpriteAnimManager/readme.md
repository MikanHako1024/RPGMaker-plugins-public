# SpriteAnimManager <精灵动画管理器>

本插件(MKP_SpriteAnimManager)用来设置动画和动画参数
播放动画由另一个插件[MKP_TextSprite](./../TextSprite)负责

首先对动画进行配置，
每个动画id可以指定一个基础动画，并且可以配置一组参数，操作详见 【插件指令】
之后在编辑消息使用特殊字串触发一些播放动画的操作，详见 插件[MKP_TextSprite](./../TextSprite)

#### 动画id
动画分为基础动画和自定义参数动画  
+ 基础动画拥有固定的默认参数，id分布在0~99  
+ 自定义参数动画可以指定一个基础动画，并使用自己设置的参数，id分布在100及以后  

#### 动画参数
可以在插件参数中配置初始动画参数  
+ 每条配置：有一个动画id，一个基础动画id，和一组参数
+ 每条参数：有一个参数序号或一个参数名，和一个参数值
也可以通过插件指令，在游戏中修改动画参数，详见 【插件指令】  

在游戏中进行的修改并不会保存，
这里的建议是，在插件参数中配置需要大量使用的固定的参数组，需要使用时直接使用对应id即可  


## 使用方法

使用插件参数或插件指令对动画进行设置，
再使用其他插件播放动画 如 插件`MKP_TextSprite`

...


## 插件指令

| description            | command |
| :----------------      | :------ |
| 设置或清除用户动画     | `AnimMgr setAnim 用户动画id 默认动画id` |
| 设置动画参数(按序号)   | `AnimMgr setParam 动画id 参数序号 参数值` |
| 设置动画参数(按参数名) | `AnimMgr setParamByKey 动画id 参数名 参数值` |
| 设置动画参数(所有参数) | `AnimMgr setParams 动画id 参数值1 参数值2 参数值3 ..` |
| 清除动画的全部参数     | `AnimMgr clearparams 动画id` |

#### 设置或清除用户动画
设置一个用户动画，这个动画使用默认动画的模板，并且可以配置参数  

* `AnimMgr setAnim 用户动画id 默认动画id`
+ AnimMgr
  - 主命令
  - 固定写法，不区分大小写
+ setAnim
  - 子命令
  - 固定写法，不区分大小写
+ 用户动画id
  - 所设置的用户动画的id
  - 数值，用户动画id，大于100
+ 默认动画id
  - 作为模板的默认动画的id
  - 数值，默认动画id，小于99，大于等于0
  - 当设置为0时，表示清除用户动画

#### 设置动画参数(按序号)
设置用户动画的一个参数的值  
用 【其他说明】-【动画列表】 中的 [参数序号] 指定参数  

* `AnimMgr setParam 动画id 参数序号 参数值`
+ AnimMgr
+ setParam
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 需要设置参数的用户动画的id
  - 同 【设置或清除用户动画】-【用户动画id】
+ 参数序号
  - 需要设置的参数的序号
  - 数值，详见 【其他说明】-【动画列表】 的 [参数序号]
+ 参数值
  - 需要设置的参数值
  - 数值或字串，详见 【其他说明】-【动画列表】 的 [参数类型]

#### 设置动画参数(按参数名)
设置用户动画的一个参数的值  
用 【其他说明】-【动画列表】 中的 [参数名] 指定参数  

* `AnimMgr setParamByKey 动画id 参数名 参数值`
+ AnimMgr
+ setParamByKey
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】
+ 参数序号
  - 需要设置的参数的参数名
  - 数值，详见 【其他说明】-【动画列表】 的 [参数名]
+ 参数值
  - 同 【设置动画参数(按序号)】-【参数值】

#### 设置动画参数(所有参数)
设置用户动画的所有参数的值  
按 【其他说明】-【动画列表】 中参数的顺序，设置每个参数的值  

* `AnimMgr setParams 动画id 参数值1 参数值2 参数值3 ..`
+ AnimMgr
+ setParams
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】
+ `参数值1 参数值2 参数值3 ..`
  - 需要设置的所有参数的参数值
  - 按 【其他说明】-【动画列表】 中的参数顺序 排列
  - 每个参数值用一个空格分隔
  - 数值或字串，详见 【其他说明】-【动画列表】 的 [参数名]

#### 清除动画的全部参数
清除用户动画的所有参数的值，恢复到默认参数值  

* `AnimMgr clearparams 动画id`
+ AnimMgr
+ clearparams
  - 子命令
  - 固定写法，不区分大小写
+ 动画id
  - 同 【设置动画参数(按序号)】-【动画id】


## 脚本说明

TODO


## 其他说明

#### 动画列表概要(MOG_AnimatedText)
以下动画效果来自 插件[`MOG_AnimatedText`](https://github.com/DrillUp/drill_plugins/blob/master/js/plugins/MOG_AnimatedText.js)  
注 : id 为 默认动画id  

| id | 动画效果 | 动画名  | 动画描述 |
| :- | :------- | :-----  | :------- |
|  1 | 淡入淡出 | Fade     | (todo) |
|  2 | 缩放     | Zoom     | (todo) |
|  3 | 翻转     | Zoom2    | (todo) |
|  4 | 上下出现(未完成) | Wipe     | (todo) |
|  5 | 震动     | Shake    | (todo) |
|  6 | 剧烈缩放 | Zoom3    | (todo) |
|  7 | 波浪缩放 | Wave     | (todo) |
|  8 | 旋涡     | Rotation | (todo) |
|  9 | 摇晃     | Swing    | (todo) |
| 10 | 随机     | Random   | (todo) |

#### 动画列表概要(新增)
以下动画效果为新增的动画  
注 : id 为 默认动画id  

| id | 动画效果 | 动画名  | 动画描述 |
| :- | :------- | :-----  | :------- |
| 11 | 卡拉OK(未完成)   | Karaoke | 模仿卡拉OK播放的效果 |

#### 动画参数

+ 1 - 缩放 - Zoom
| 序号 | 描述             | 参数名       | 值类型 | 默认值 | 备注 |
| :--- | :-----------     | :---------   | :----- | :----- | :--- |
|   0  | 初始不透明度     | opacityStart | 数值   | 0      |  |
|   1  | 结束不透明度     | opacityEnd   | 数值   | 255    |  |
|   2  | 不透明度变化速度 | opacitySpeed | 数值   | 5      |  |

+ 2 - 淡入淡出 - Fade
| 序号 | 描述             | 参数名       | 值类型 | 默认值 | 备注 |
| :--- | :-----------     | :---------   | :----- | :----- | :--- |
|   0  | 初始不透明度     | opacityStart | 数值  | 0     |  |
|   1  | 结束不透明度     | opacityEnd   | 数值  | 255   |  |
|   2  | 不透明度变化速度 | opacitySpeed | 数值  | 4     |  |
|   3  | 初始X缩放        | scaleXStart  | 数值  | 2.0   |  |
|   4  | 结束X缩放        | scaleXEnd    | 数值  | 1.0   |  |
|   5  | X缩放变化速度    | scaleXSpeed  | 数值  | -0.04 |  |
|   6  | 初始Y缩放        | scaleYStart  | 数值  | 2.0   |  |
|   7  | 结束Y缩放        | scaleYEnd    | 数值  | 1.0   |  |
|   8  | Y缩放变化速度    | scaleYSpeed  | 数值  | -0.04 |  |

+ 3 - 翻转 - Zoom2
| 序号 | 描述             | 参数名       | 值类型 | 默认值 | 备注 |
| :--- | :-----------     | :---------    | :----- | :----- | :--- |
|   0  | 初始不透明度     | opacityStart  | 数值  | 0     |  |
|   1  | 结束不透明度     | opacityEnd    | 数值  | 255   |  |
|   2  | 不透明度变化速度 | opacitySpeed | 数值  | 4     |  |
|   3  | 初始X缩放        | scaleXStart  | 数值  | -1.0  |  |
|   4  | 结束X缩放        | scaleXEnd    | 数值  | 1.0   |  |
|   5  | X缩放变化速度    | scaleXSpeed  | 数值  | 0.02  |  |
|   6  | 初始Y缩放        | scaleYStart  | 数值  | 2.0   |  |
|   7  | 结束Y缩放        | scaleYEnd    | 数值  | 1.0   |  |
|   8  | Y缩放变化速度    | scaleYSpeed  | 数值  | -0.02 |  |

+ 4 - 上下出现 - Wipe

+ 5 - 震动 - Shake
| 序号 | 描述                | 参数名          | 值类型 | 默认值 | 备注 |
| :--- | :-----------        | :---------      | :----- | :----- | :--- |
|   0  | 震动间隔(帧数)      | shakeWaitCount  | 数值  | 3     |  |
|   1  | 震动幅度(像素)      | shakeAmplitude  | 数值  | 3     |  |
|   2  | 是否停止(0不停;1停) | shakeNeedStop   | 0或1  | 0     |  |
|   3  | 震动总计数(若停止)  | shakeTotalCount | 数值  | 12   |  |

+ 6 - 剧烈缩放 - Zoom3
| 序号 | 描述              | 参数名         | 值类型 | 默认值 | 备注 |
| :--- | :-----------      | :---------     | :----- | :----- | :--- |
|   0  | 初始不透明度      | opacityStart   | 数值  | 0      |  |
|   1  | 结束不透明度      | opacityEnd     | 数值  | 255    |  |
|   2  | 不透明度变化速度  | opacitySpeed   | 数值  | 20     |  |
|   3  | 初始X缩放         | scaleXStart    | 数值  | 4.0    |  |
|   4  | 结束X缩放         | scaleXEnd      | 数值  | 1.0    |  |
|   5  | X缩放变化速度     | scaleXSpeed    | 数值  | -0.2   |  |
|   6  | 初始Y缩放         | scaleYStart    | 数值  | 4.0    |  |
|   7  | 结束Y缩放         | scaleYEnd      | 数值  | 1.0    |  |
|   8  | Y缩放变化速度     | scaleYSpeed    | 数值  | -0.2   |  |
|   9  | 震动间隔(帧数)    | shakeWaitCount | 数值  | 3      |  |
|  10  | 震动幅度(像素)    | shakeAmplitude | 数值  | 3      |  |
|  11  | 是否停止          | shakeNeedStop   | 0或1  | 0     | 0不停;1停 |
|  12  | 震动总计数        | shakeTotalCount | 数值  | 12    | 若停止 |

+ 7 - 剧烈缩放 - Zoom3
| 序号 | 描述       | 参数名     | 值类型 | 默认值 | 备注 |
| :--- | :-------   | :--------- | :----  | :---- | :--- |
|   0  | 缩放速度   | scaleSpeed | 数值   | 0.015 |  |
|   1  | 缩放帧数   | scaleCount | 数值   | 30    | 来或回一次的 |
|   2  | 总循环次数 | loopTotal  | 数值   | 1     |  |

+ 8 - 旋涡 - Rotation

+ 9 - 摇晃 - Swing
| 序号 | 描述         | 参数名       | 值类型 | 默认值 | 备注 |
| :--- | :---------   | :---------    | :----- | :----- | :--- |
|   0  | 旋转速度     | rotateSpeed    | 数值  | 0.02  | 角度/帧 |
|   1  | 初始旋转方向 | rotateInitDir  | 文本  | R     | L逆;R顺 |
|   2  | 初始角度     | angleInit      | 数值  | 0     | 正顺;负逆 |
|   3  | 角度左范围   | angleRangeL    | 数值  | -0.4   |  |
|   4  | 角度右范围   | angleRangeR    | 数值  | 0.4   |  |

+ 10 - 随机 - Random
| 序号 | 描述             | 参数名        | 值类型 | 默认值 | 备注 |
| :--- | :-----------     | :---------    | :----- | :----- | :--- |
|   0  | 初始不透明度     | opacityStart  | 数值  | 0     |  |
|   1  | 结束不透明度     | opacityEnd    | 数值  | 255   |  |
|   2  | 不透明度变化速度 | opacitySpeed  | 数值  | 4     |  |
|   3  | 缩放最小范围     | scaleRangeMin | 数值  | 0.7   |  |
|   4  | 缩放最大范围     | scaleRangeMax | 数值  | 1.4   |  |
|   5  | 旋转范围         | rotateRange   | 数值  | 0.4   |  |
|   6  | 旋转方向         | rotateDir     | 文本  | R     | L逆;R顺 |

+ 11 - 卡拉OK - Karaoke
| 序号 | 描述               | 参数名     | 值类型 | 默认值 | 备注 |
| :--- | :-----------       | :--------- | :----- | :----- | :--- |
|   0  | 初始不透明度       | playSpeed  | 数值  | 2       |  |
|   1  | 边框线宽           | lineWidth  | 数值  | 4       |  |
|   2  | 播放前文本边框颜色 | uLineColor | 文本  | #FFFFFF | 颜色 |
|   3  | 播放前文本颜色     | uTextColor | 文本  | #000000 | 颜色 |
|   4  | 播放后文本边框颜色 | dLineColor | 文本  | #000000  | 颜色 |
|   5  | 播放后文本颜色     | dTextColor | 文本  | #FFFFFF | 颜色 |


#### 对于简化设置决定的说明

简化设置方面，有两种方案：  
一是保存在游戏存档中  
可以保存，所以在游戏开始时进行统一设置即可，这样可能会因为使用过期存档而失效  
二是使用插件参数进行设置  
这样每次启动会重置设置，所以不能保存，但是不会因为使用过期存档而失效  
二者不能兼得。  

这里使用方案二，原因如下：  
考虑到 固定设置的情况 比 根据游戏情况需要调整设置的情况 多；  
因为变数多，而使得保险起见会在使用前再次进行设置，所以使用到保存数据的设置的情况较少；  
多次使用固定设置时，为了方便调整设置，不建议在每次使用前都进行设置，  
作为代替的是，使用固定的一组设置，并把这组设置放在插件参数中。  


## 后续任务

- [ ] 更符合Karaoke


## Author
Mikan(MikanHako)  
Copyright (C) 2020-2021 Mikan(MikanHako)  
